<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>访问远程服务 | sakever 的博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/yf_blog/blogger_icon.ico">
    <meta name="description" content="记录学习到的知识">
    <meta name="theme-color" content="#14204193">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="preload" href="/yf_blog/assets/css/0.styles.743290fa.css" as="style"><link rel="preload" href="/yf_blog/assets/js/app.f151afcb.js" as="script"><link rel="preload" href="/yf_blog/assets/js/3.86e8edc4.js" as="script"><link rel="preload" href="/yf_blog/assets/js/2.e5572c9a.js" as="script"><link rel="preload" href="/yf_blog/assets/js/124.0fbcc996.js" as="script"><link rel="prefetch" href="/yf_blog/assets/js/1.368c97ab.js"><link rel="prefetch" href="/yf_blog/assets/js/10.3d1375a6.js"><link rel="prefetch" href="/yf_blog/assets/js/100.4d9838da.js"><link rel="prefetch" href="/yf_blog/assets/js/101.ce91e2df.js"><link rel="prefetch" href="/yf_blog/assets/js/102.48b16c3f.js"><link rel="prefetch" href="/yf_blog/assets/js/103.9b9ee5c5.js"><link rel="prefetch" href="/yf_blog/assets/js/104.32a79306.js"><link rel="prefetch" href="/yf_blog/assets/js/105.b6dbc85d.js"><link rel="prefetch" href="/yf_blog/assets/js/106.91feea01.js"><link rel="prefetch" href="/yf_blog/assets/js/107.8d859c7a.js"><link rel="prefetch" href="/yf_blog/assets/js/108.4687f40b.js"><link rel="prefetch" href="/yf_blog/assets/js/109.ce754f1e.js"><link rel="prefetch" href="/yf_blog/assets/js/11.a58d4534.js"><link rel="prefetch" href="/yf_blog/assets/js/110.e0945db2.js"><link rel="prefetch" href="/yf_blog/assets/js/111.cd2ac106.js"><link rel="prefetch" href="/yf_blog/assets/js/112.a3df89bd.js"><link rel="prefetch" href="/yf_blog/assets/js/113.4ecd954b.js"><link rel="prefetch" href="/yf_blog/assets/js/114.bb7df3e1.js"><link rel="prefetch" href="/yf_blog/assets/js/115.6fbc1ebf.js"><link rel="prefetch" href="/yf_blog/assets/js/116.d8479bb2.js"><link rel="prefetch" href="/yf_blog/assets/js/117.0dfcc18b.js"><link rel="prefetch" href="/yf_blog/assets/js/118.5a218e50.js"><link rel="prefetch" href="/yf_blog/assets/js/119.eec00c9c.js"><link rel="prefetch" href="/yf_blog/assets/js/12.c82c7c16.js"><link rel="prefetch" href="/yf_blog/assets/js/120.36dc54c5.js"><link rel="prefetch" href="/yf_blog/assets/js/121.74ef3c83.js"><link rel="prefetch" href="/yf_blog/assets/js/122.f0f792f4.js"><link rel="prefetch" href="/yf_blog/assets/js/123.c51b1b10.js"><link rel="prefetch" href="/yf_blog/assets/js/125.3272a79b.js"><link rel="prefetch" href="/yf_blog/assets/js/126.380c77c2.js"><link rel="prefetch" href="/yf_blog/assets/js/127.fd8ac9ac.js"><link rel="prefetch" href="/yf_blog/assets/js/128.25788dbe.js"><link rel="prefetch" href="/yf_blog/assets/js/129.fc0499e1.js"><link rel="prefetch" href="/yf_blog/assets/js/13.ea6b5163.js"><link rel="prefetch" href="/yf_blog/assets/js/130.8cda15b7.js"><link rel="prefetch" href="/yf_blog/assets/js/131.a1818a91.js"><link rel="prefetch" href="/yf_blog/assets/js/132.3f5ee232.js"><link rel="prefetch" href="/yf_blog/assets/js/133.4a01df45.js"><link rel="prefetch" href="/yf_blog/assets/js/134.a4ccd439.js"><link rel="prefetch" href="/yf_blog/assets/js/135.ef246441.js"><link rel="prefetch" href="/yf_blog/assets/js/136.a7b98da7.js"><link rel="prefetch" href="/yf_blog/assets/js/137.10b60c13.js"><link rel="prefetch" href="/yf_blog/assets/js/138.7fea3536.js"><link rel="prefetch" href="/yf_blog/assets/js/139.4eae6fe5.js"><link rel="prefetch" href="/yf_blog/assets/js/14.4770d6f2.js"><link rel="prefetch" href="/yf_blog/assets/js/140.05f0838a.js"><link rel="prefetch" href="/yf_blog/assets/js/141.b36e8cc8.js"><link rel="prefetch" href="/yf_blog/assets/js/142.1d573e0a.js"><link rel="prefetch" href="/yf_blog/assets/js/143.e547ea90.js"><link rel="prefetch" href="/yf_blog/assets/js/144.862e9797.js"><link rel="prefetch" href="/yf_blog/assets/js/145.6a3f5cb4.js"><link rel="prefetch" href="/yf_blog/assets/js/146.5852f2b7.js"><link rel="prefetch" href="/yf_blog/assets/js/147.7ad8534b.js"><link rel="prefetch" href="/yf_blog/assets/js/148.b4750145.js"><link rel="prefetch" href="/yf_blog/assets/js/149.c35ea20a.js"><link rel="prefetch" href="/yf_blog/assets/js/15.52c2bc6f.js"><link rel="prefetch" href="/yf_blog/assets/js/150.172573eb.js"><link rel="prefetch" href="/yf_blog/assets/js/151.7f347fa1.js"><link rel="prefetch" href="/yf_blog/assets/js/152.f8188e8e.js"><link rel="prefetch" href="/yf_blog/assets/js/153.d8ab5c79.js"><link rel="prefetch" href="/yf_blog/assets/js/154.5366e19c.js"><link rel="prefetch" href="/yf_blog/assets/js/155.d478b608.js"><link rel="prefetch" href="/yf_blog/assets/js/156.97cdf340.js"><link rel="prefetch" href="/yf_blog/assets/js/157.8007b327.js"><link rel="prefetch" href="/yf_blog/assets/js/158.5e2afba9.js"><link rel="prefetch" href="/yf_blog/assets/js/159.d13c9800.js"><link rel="prefetch" href="/yf_blog/assets/js/16.aa789364.js"><link rel="prefetch" href="/yf_blog/assets/js/160.e91645e7.js"><link rel="prefetch" href="/yf_blog/assets/js/161.e0b1cfb8.js"><link rel="prefetch" href="/yf_blog/assets/js/162.03c9592c.js"><link rel="prefetch" href="/yf_blog/assets/js/163.66db9e4b.js"><link rel="prefetch" href="/yf_blog/assets/js/164.39be723a.js"><link rel="prefetch" href="/yf_blog/assets/js/165.ba5a24bf.js"><link rel="prefetch" href="/yf_blog/assets/js/166.b4d9d01b.js"><link rel="prefetch" href="/yf_blog/assets/js/167.e76a183f.js"><link rel="prefetch" href="/yf_blog/assets/js/168.11f7e34c.js"><link rel="prefetch" href="/yf_blog/assets/js/169.6a6bd39a.js"><link rel="prefetch" href="/yf_blog/assets/js/17.05e8b595.js"><link rel="prefetch" href="/yf_blog/assets/js/170.f97d05a6.js"><link rel="prefetch" href="/yf_blog/assets/js/171.9212ddb1.js"><link rel="prefetch" href="/yf_blog/assets/js/172.10f0d229.js"><link rel="prefetch" href="/yf_blog/assets/js/173.bf5b9980.js"><link rel="prefetch" href="/yf_blog/assets/js/174.5ccb9a71.js"><link rel="prefetch" href="/yf_blog/assets/js/175.fda01598.js"><link rel="prefetch" href="/yf_blog/assets/js/176.86339415.js"><link rel="prefetch" href="/yf_blog/assets/js/177.a932f1c3.js"><link rel="prefetch" href="/yf_blog/assets/js/178.4343d58b.js"><link rel="prefetch" href="/yf_blog/assets/js/179.c8686132.js"><link rel="prefetch" href="/yf_blog/assets/js/18.ff40c92f.js"><link rel="prefetch" href="/yf_blog/assets/js/180.bad9ed85.js"><link rel="prefetch" href="/yf_blog/assets/js/181.d6102109.js"><link rel="prefetch" href="/yf_blog/assets/js/182.704c4ff5.js"><link rel="prefetch" href="/yf_blog/assets/js/183.e1ea6956.js"><link rel="prefetch" href="/yf_blog/assets/js/184.88c0e5e3.js"><link rel="prefetch" href="/yf_blog/assets/js/185.816d101a.js"><link rel="prefetch" href="/yf_blog/assets/js/186.0829c829.js"><link rel="prefetch" href="/yf_blog/assets/js/187.a10b105c.js"><link rel="prefetch" href="/yf_blog/assets/js/188.0c3aca7a.js"><link rel="prefetch" href="/yf_blog/assets/js/189.0f1ba010.js"><link rel="prefetch" href="/yf_blog/assets/js/19.ae59133e.js"><link rel="prefetch" href="/yf_blog/assets/js/190.1d2f4463.js"><link rel="prefetch" href="/yf_blog/assets/js/191.33a0ce70.js"><link rel="prefetch" href="/yf_blog/assets/js/192.adfd3c22.js"><link rel="prefetch" href="/yf_blog/assets/js/193.acdd3225.js"><link rel="prefetch" href="/yf_blog/assets/js/194.a2b1156e.js"><link rel="prefetch" href="/yf_blog/assets/js/195.877287ee.js"><link rel="prefetch" href="/yf_blog/assets/js/196.4797560a.js"><link rel="prefetch" href="/yf_blog/assets/js/197.ce7d384d.js"><link rel="prefetch" href="/yf_blog/assets/js/198.f98e6edf.js"><link rel="prefetch" href="/yf_blog/assets/js/199.865abc5d.js"><link rel="prefetch" href="/yf_blog/assets/js/20.7b86335d.js"><link rel="prefetch" href="/yf_blog/assets/js/21.f3f5c621.js"><link rel="prefetch" href="/yf_blog/assets/js/22.e0a1f5a4.js"><link rel="prefetch" href="/yf_blog/assets/js/23.7eabb604.js"><link rel="prefetch" href="/yf_blog/assets/js/24.8a88487b.js"><link rel="prefetch" href="/yf_blog/assets/js/25.59e0b3d9.js"><link rel="prefetch" href="/yf_blog/assets/js/26.a620c3de.js"><link rel="prefetch" href="/yf_blog/assets/js/27.5ab2aa34.js"><link rel="prefetch" href="/yf_blog/assets/js/28.1d4aac9c.js"><link rel="prefetch" href="/yf_blog/assets/js/29.468a0343.js"><link rel="prefetch" href="/yf_blog/assets/js/30.2d61f6ce.js"><link rel="prefetch" href="/yf_blog/assets/js/31.1b04d40c.js"><link rel="prefetch" href="/yf_blog/assets/js/32.72792376.js"><link rel="prefetch" href="/yf_blog/assets/js/33.4d09633e.js"><link rel="prefetch" href="/yf_blog/assets/js/34.06cff91e.js"><link rel="prefetch" href="/yf_blog/assets/js/35.dbf9d27d.js"><link rel="prefetch" href="/yf_blog/assets/js/36.b4571a58.js"><link rel="prefetch" href="/yf_blog/assets/js/37.f102a4ac.js"><link rel="prefetch" href="/yf_blog/assets/js/38.6f5eb637.js"><link rel="prefetch" href="/yf_blog/assets/js/39.71df10b9.js"><link rel="prefetch" href="/yf_blog/assets/js/4.631c4c1e.js"><link rel="prefetch" href="/yf_blog/assets/js/40.ab90417a.js"><link rel="prefetch" href="/yf_blog/assets/js/41.62f66f7e.js"><link rel="prefetch" href="/yf_blog/assets/js/42.edb19481.js"><link rel="prefetch" href="/yf_blog/assets/js/43.ab2058fc.js"><link rel="prefetch" href="/yf_blog/assets/js/44.1a537946.js"><link rel="prefetch" href="/yf_blog/assets/js/45.ada8184c.js"><link rel="prefetch" href="/yf_blog/assets/js/46.0be0bcb0.js"><link rel="prefetch" href="/yf_blog/assets/js/47.36490ac3.js"><link rel="prefetch" href="/yf_blog/assets/js/48.05c3629a.js"><link rel="prefetch" href="/yf_blog/assets/js/49.f24b1024.js"><link rel="prefetch" href="/yf_blog/assets/js/5.e4024f1e.js"><link rel="prefetch" href="/yf_blog/assets/js/50.2497b896.js"><link rel="prefetch" href="/yf_blog/assets/js/51.5f26e401.js"><link rel="prefetch" href="/yf_blog/assets/js/52.298a4a18.js"><link rel="prefetch" href="/yf_blog/assets/js/53.c1795ab8.js"><link rel="prefetch" href="/yf_blog/assets/js/54.c61572c2.js"><link rel="prefetch" href="/yf_blog/assets/js/55.2382afe4.js"><link rel="prefetch" href="/yf_blog/assets/js/56.c44cc9e8.js"><link rel="prefetch" href="/yf_blog/assets/js/57.0fcd494c.js"><link rel="prefetch" href="/yf_blog/assets/js/58.945bcf67.js"><link rel="prefetch" href="/yf_blog/assets/js/59.8b5b511e.js"><link rel="prefetch" href="/yf_blog/assets/js/6.e0040f07.js"><link rel="prefetch" href="/yf_blog/assets/js/60.c6a8c030.js"><link rel="prefetch" href="/yf_blog/assets/js/61.28ff28d7.js"><link rel="prefetch" href="/yf_blog/assets/js/62.f6709ed3.js"><link rel="prefetch" href="/yf_blog/assets/js/63.da115ba7.js"><link rel="prefetch" href="/yf_blog/assets/js/64.3f4494e9.js"><link rel="prefetch" href="/yf_blog/assets/js/65.75e8b993.js"><link rel="prefetch" href="/yf_blog/assets/js/66.7d4f67dd.js"><link rel="prefetch" href="/yf_blog/assets/js/67.86828624.js"><link rel="prefetch" href="/yf_blog/assets/js/68.36008882.js"><link rel="prefetch" href="/yf_blog/assets/js/69.d87fe82b.js"><link rel="prefetch" href="/yf_blog/assets/js/70.2c2d57e7.js"><link rel="prefetch" href="/yf_blog/assets/js/71.94bc9203.js"><link rel="prefetch" href="/yf_blog/assets/js/72.a25d48b3.js"><link rel="prefetch" href="/yf_blog/assets/js/73.19df6a84.js"><link rel="prefetch" href="/yf_blog/assets/js/74.f493009b.js"><link rel="prefetch" href="/yf_blog/assets/js/75.60c2308c.js"><link rel="prefetch" href="/yf_blog/assets/js/76.73237782.js"><link rel="prefetch" href="/yf_blog/assets/js/77.d0e030b8.js"><link rel="prefetch" href="/yf_blog/assets/js/78.88c5c43f.js"><link rel="prefetch" href="/yf_blog/assets/js/79.0c3b93d2.js"><link rel="prefetch" href="/yf_blog/assets/js/80.ff24ca19.js"><link rel="prefetch" href="/yf_blog/assets/js/81.5c44f27a.js"><link rel="prefetch" href="/yf_blog/assets/js/82.1b50236f.js"><link rel="prefetch" href="/yf_blog/assets/js/83.5d5cb774.js"><link rel="prefetch" href="/yf_blog/assets/js/84.d696eb02.js"><link rel="prefetch" href="/yf_blog/assets/js/85.395d6680.js"><link rel="prefetch" href="/yf_blog/assets/js/86.f46437fd.js"><link rel="prefetch" href="/yf_blog/assets/js/87.5e24f0c3.js"><link rel="prefetch" href="/yf_blog/assets/js/88.f70a2a74.js"><link rel="prefetch" href="/yf_blog/assets/js/89.79b7de7e.js"><link rel="prefetch" href="/yf_blog/assets/js/9.77d321d8.js"><link rel="prefetch" href="/yf_blog/assets/js/90.2bbcfb51.js"><link rel="prefetch" href="/yf_blog/assets/js/91.e328fc76.js"><link rel="prefetch" href="/yf_blog/assets/js/92.99ee4d2d.js"><link rel="prefetch" href="/yf_blog/assets/js/93.798c2a1a.js"><link rel="prefetch" href="/yf_blog/assets/js/94.97634ea4.js"><link rel="prefetch" href="/yf_blog/assets/js/95.57b87960.js"><link rel="prefetch" href="/yf_blog/assets/js/96.58641450.js"><link rel="prefetch" href="/yf_blog/assets/js/97.74beaa58.js"><link rel="prefetch" href="/yf_blog/assets/js/98.db6d98f0.js"><link rel="prefetch" href="/yf_blog/assets/js/99.54c78e8d.js"><link rel="prefetch" href="/yf_blog/assets/js/vendors~docsearch.6de48227.js">
    <link rel="stylesheet" href="/yf_blog/assets/css/0.styles.743290fa.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yf_blog/" class="home-link router-link-active"><!----> <span class="site-name">sakever 的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/yf_blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/yf_blog/_posts/" class="nav-link">博客</a></div><div class="nav-item"><a href="/yf_blog/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/yf_blog/tags/" class="nav-link">标签</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/yf_blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/yf_blog/_posts/" class="nav-link">博客</a></div><div class="nav-item"><a href="/yf_blog/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/yf_blog/tags/" class="nav-link">标签</a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><!----> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-05-04</a></div> <div title="分类" class="date iconfont icon-wenjian" data-v-06225672><a href="/yf_blog/categories/?category=%E5%88%86%E5%B8%83%E5%BC%8F" data-v-06225672>分布式 </a></div></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">访问远程服务<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>为了将我们的系统设计的更加复杂一点，让它的功能更加多一些，让用户的体验更好一些，我们应该将单机的服务慢慢转换成分布式的系统，而分布式的系统有一个非常重要的前提条件：各个主机之间是如何交互的</p> <h2 id="进程间通信"><a href="#进程间通信" class="header-anchor">#</a> 进程间通信</h2> <p>远程服务调用的出现是为了让计算机能够跟调用本地方法一样去调用远程方法，而刚好 Socket 是网络栈的统一接口，各个系统中也都有提供标准接口可以直接使用</p> <p>那我们先从先从进程间通信（Inter-Process Communication，本地 IPC 通讯）讲起，在计算机操作系统中，进程间的通信方式应该大致分为四类，加上进程间同步，一个可以数出以下几种方式：</p> <ul><li><p>共享内存：两个进程共享同一块物理内存空间，这种方式需要依靠某种同步操作，如互斥锁和信号量等，因为可能会出现修改丢失问题，所以两个进程对内存空间的访问必须是互斥的</p></li> <li><p>管道通信：管道是一种在内存中具有一定空间的缓冲区，在 Linux 系统中叫 pipe 文件，与在磁盘中的 .txt 等文件相似，只能一个进程向文件中写入数据，另一个进程从文件中读取数据，一个进程写数据时另外一个进程不能读数据，两个进程需要互斥访问管道；管道又分匿名管道和有名管道。我们经常使用的命令行中的 “ | ” 操作符，就是典型的管道</p></li> <li><p>消息传递：直接将消息从一个进程传到另一个进程中，消息（message）是一种封装了数据的东西，比如报文；这种通信方式又分直接通信（通过系统源语实现，一个进程通过发送源语将消息挂到另一个进程的消息访问队列中，进程通过接受源语接受）和间接通信（消息队列），信号和消息队列应该是属于消息传递的</p></li> <li><p>套接字接口：主要实现为套接字（一个存放了目的地址、目的端口、传输层协议、自己地址的数据结构）、RPC，主要用与网络间进程的通信，不过也可以在同一台主机上通信（原始套接字）</p></li> <li><p>信号：信号用于通知目标进程有某种事件发生，比如 kill 命令，由 shell 进程向指定的 pid 发送消息</p></li> <li><p>信号量：信号量用于在两个进程之间同步协作，相当与操作系统提供的特殊变量，程序可以通过这个进行 wait 与 notify</p></li></ul> <h2 id="关于-rpc-的三个基本问题"><a href="#关于-rpc-的三个基本问题" class="header-anchor">#</a> 关于 RPC 的三个基本问题</h2> <p>远程服务调用是指位于互不重合的内存地址空间中的两个程序，在语言层面上，以同步的方式使用带宽有限的信道来传输程序控制信息</p> <p>在实现这个的过程中我们慢慢发现 RPC 一定绕不开三个问题，几乎所有的 RPC 协议都是围绕着解决以下三个基本问题：</p> <ul><li>如何表示数据：这里的数据包括传递给方法的参数以及方法执行后的返回值在，这些在网络中如何表示呢。在不同的硬件指令集、操作系统下，同样的数据有2不同的表现实现，可行的做法是将两边的数据定义事先约定好的中立数据结构来传递。对，就是序列化</li> <li>如何传递数据：我们有了数据在网络中的表示，那这些数据该如何传输呢，我们是用 http 还是 tcp？发生异常、超时、事务等情况的时候，网络如何处理呢</li> <li>如何确定方法：在本地调用方法的时候，编译器会根据指针确定方法的位置，但是在 rpc 里，每种语言的方法签名都有可能有差别，如何表示同一个方法需要有一个统一的跨语言的标准才行，比如用一个 UUID 来确定方法</li></ul> <h2 id="rest-设计风格"><a href="#rest-设计风格" class="header-anchor">#</a> REST 设计风格</h2> <p>很多人会拿 rest 与 rpc 来比较，<strong>REST 是一种面向资源编程的风格</strong>（REST 是 Representational State Transfer 表征状态转移的缩写），是风格而不是协议，具体如何实现他们没有限定死</p> <p>REST 无论是在思想上、概念上，还是使用范围上，与 RPC 都不尽相同，即面向资源的编程思想与面向过程的编程思想两者之间的区别</p> <p>由于绑定 HTTP 协议，性能瓶颈也明显，但在移动端、桌面端或者分布式服务端的节点之间通讯这一块，REST 照样有宽阔的用武之地</p> <h3 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h3> <p>先来了解一些 REST 的概念：</p> <ul><li><p>资源：也就是内容本身，比如你正在读一篇&lt;&lt;REST设计风格&gt;&gt;的文章，这篇文章的内容称之为资源。可以理解为信息、数据</p></li> <li><p>表征：资源的表达形式，如 HTML，PDF 等</p></li> <li><p>状态：上下文状态。当你读完这篇文章，想看后面是什么内容时，你向服务端发出给我下一篇文章的请求。但是下一篇是个相对的概念，必须依赖你当前正在阅读的文章是哪一篇才能正确回应，这类在特定语境中产生的上下文信息被称为状态</p></li> <li><p>转移：无论状态是由服务端还是客户端来提供，取下一篇文章这个行为逻辑只能由服务端来提供，因为只有服务端拥有该资源及其表征形式。服务端通过某种方式，把用户当前阅读的文章转变成下一篇文章，这就被称为表征状态转移</p></li> <li><p>统一接口：HTTP 请求方法就是统一接口</p></li> <li><p>超文本驱动：PC 软件客户端一般都是有专门的控制器来驱动状态转移，而 web 端是由服务器发出响应来驱动的，也叫超文本驱动。任何网站的导航（状态转移）行为都不是预置于浏览器代码中的，而是通过服务器发出的请求响应信息（超文本）来驱动的</p></li> <li><p>自描述消息：资源可能有多种表征，所以消息中一般有自描述信息，即告知服务器该消息的类型的消息，如 “Content-Type”</p></li></ul> <h3 id="rest-的六大原则"><a href="#rest-的六大原则" class="header-anchor">#</a> REST 的六大原则</h3> <p>一套理想的、完全满足 REST 的系统应该满足以下六大原则：</p> <h4 id="客户端与服务端分离"><a href="#客户端与服务端分离" class="header-anchor">#</a> 客户端与服务端分离</h4> <p>就是我们通常说的网页，前后端分离，将用户界面所关注的逻辑和数据存储所关注的逻辑分离开来。与之对应的是以前完全基于服务端控制和渲染（如 JSF 这类）框架</p> <h4 id="无状态"><a href="#无状态" class="header-anchor">#</a> 无状态</h4> <p>无状态是 REST 的核心原则，REST 风格的服务设计的别扭很可能的一个原因是服务端持有着比较重的状态。<strong>REST 希望服务器不要去负责维护状态，每一次从客户端发送的请求中，应包括所有的必要的上下文信息，会话信息也由客户端负责保存维护</strong>，服务端依据客户端传递的状态来执行业务处理逻辑，驱动整个应用的状态变迁</p> <p><strong>可以将 Cookie 的使用当成无状态的实践之一</strong>，但是极大部分系统都不可能达到真正的无状态，因为大量的上下文状态会膨胀到客户端无法承受的程度</p> <h4 id="可缓存"><a href="#可缓存" class="header-anchor">#</a> 可缓存</h4> <p>REST 希望软件系统能够如同万维网一样，允许客户端和中间的通讯传递者（譬如代理）将部分服务端的应答缓存起来。缓存整个应答的资源数据</p> <h4 id="分层系统"><a href="#分层系统" class="header-anchor">#</a> 分层系统</h4> <p>这里所指的并不是表示层、服务层、持久层这种意义上的分层。而是指客户端一般不需要知道是否直接连接到了最终的服务器，抑或连接到路径上的中间服务器。<strong>中间服务器可以通过负载均衡和共享缓存的机制提高系统的可扩展性</strong>，这样也便于缓存、伸缩和安全策略的部署。该原则的典型的应用是内容分发网络 CDN，比如 GitHub Pages 的源服务器与国内的 CDN 服务器</p> <p>分层系统一定程度上是可缓存的实现，而可缓存是分层系统的思想</p> <h4 id="统一接口"><a href="#统一接口" class="header-anchor">#</a> 统一接口</h4> <p>REST 希望开发者面向资源编程，<strong>希望软件系统设计的重点放在抽象系统该有哪些资源上，而不是抽象系统该有哪些行为（服务）上</strong>。面向资源编程的抽象程度通常更高。抽象程度高意味着坏处是往往距离人类的思维方式更远，而好处是往往通用程度会更好，简单来说是<strong>每个资源有唯一 URI 标识</strong></p> <p>那到底什么是统一接口呢，行为与资源的区别是什么呢？</p> <p>行为是指我们提供一个接口，这个接口实现了用户下单的操作，但是接口要求将操作的每一个数据都尽可能传给后端来处理这个下单操作，比如要传入：产品的标题、数量、金额、属性等等等等，同时要传入购买人的属性，比如姓名、身份证啥的。而面向资源则是推荐将产品浓缩成资源 ID，联系人也使用 user id 来表示，其他的信息后端从数据库中获取</p> <p>要在架构设计中合理恰当地利用统一接口，Fielding 建议：</p> <ul><li>系统应能做到每次请求中都包含资源的 ID，所有操作均通过资源 ID 来进行（当然在实际中不用这样，可以将一些比较重的数据用 ID 表示，比如订单信息、产品信息等，而三四个字段就直接传给后端就可以了）</li> <li>每个资源都应该是自描述的消息</li> <li>通过超文本来驱动应用状态的转移</li></ul> <h4 id="按需代码"><a href="#按需代码" class="header-anchor">#</a> 按需代码</h4> <p>按需代码被 Fielding 列为一条可选原则。它是指任何按照客户端（譬如浏览器）的请求，将可执行的软件程序从服务器发送到客户端的技术，按需代码赋予了客户端无需事先知道所有来自服务端的信息应该如何处理、如何运行的宽容度</p> <p>REST 的以资源为主体的服务设计风格，可以带来不少好处：</p> <ul><li>降低的服务接口的学习成本：统一接口（Uniform Interface）是 REST 的重要标志，将对资源的标准操作都映射到了标准的 HTTP 方法上去</li> <li>资源天然具有集合与层次结构</li> <li>REST 绑定于 HTTP 协议。面向资源编程不是必须构筑在 HTTP 之上，但 REST 是，这是缺点，也是优点。因为 HTTP 本来就是面向资源而设计的网络协议</li></ul> <h3 id="rmm"><a href="#rmm" class="header-anchor">#</a> RMM</h3> <p>《RESTful Web APIs》和《RESTful Web Services》的作者 Leonard Richardson 曾提出过一个衡量“服务有多么 REST”的 Richardson 成熟度模型（Richardson Maturity Model），便于那些原本不使用 REST 的系统，能够逐步地导入 REST</p> <h4 id="the-swamp-of-plain-old-xml-完全不-rest"><a href="#the-swamp-of-plain-old-xml-完全不-rest" class="header-anchor">#</a> The Swamp of Plain Old XML：完全不 REST</h4> <p>即 RPC 的调用方式，例子如下</p> <p>医院开放了一个/appointmentService的 Web API，传入日期、医生姓名作为参数，可以得到该时间段该名医生的空闲时间，该 API 的一次 HTTP 调用如下所示：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /appointmentService?action=query HTTP/<span class="token number">1.1</span>
<span class="token punctuation">{</span>date<span class="token operator">:</span> <span class="token string">&quot;2020-03-04&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后服务器会传回一个包含了所需信息的回应：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
<span class="token punctuation">[</span>
	<span class="token punctuation">{</span>start<span class="token operator">:</span><span class="token string">&quot;14:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;14:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>start<span class="token operator">:</span><span class="token string">&quot;16:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;16:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>得到了医生空闲的结果后，我觉得 14:00 的时间比较合适，于是进行预约确认，并提交了我的基本信息：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /appointmentService?action=comfirm HTTP/<span class="token number">1.1</span>
<span class="token punctuation">{</span>
	appointment<span class="token operator">:</span> <span class="token punctuation">{</span>date<span class="token operator">:</span> <span class="token string">&quot;2020-03-04&quot;</span><span class="token punctuation">,</span> start<span class="token operator">:</span><span class="token string">&quot;14:00&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	patient<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> icyfenix<span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> ……<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果预约成功，那我能够收到一个预约成功的响应。如果发生了问题，譬如有人在我前面抢先预约了，那么我会在响应中收到某种错误信息：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
<span class="token punctuation">{</span>
	code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	message<span class="token operator">:</span> <span class="token string">&quot;Successful confirmation of appointment&quot;</span>
<span class="token punctuation">}</span>

HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
<span class="token punctuation">{</span>
	code<span class="token operator">:</span> <span class="token number">1</span>
	message<span class="token operator">:</span> <span class="token string">&quot;doctor not available&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="resources-开始引入资源的概念"><a href="#resources-开始引入资源的概念" class="header-anchor">#</a> Resources：开始引入资源的概念</h4> <p>第 0 级是 RPC 的风格，如果需求永远不会变化，也不会增加，那它完全可以良好地工作下去。但是，如果你不想为预约医生之外的其他操作、为获取空闲时间之外的其他信息去编写额外的方法，或者改动现有方法的接口，那还是应该考虑一下如何使用 REST 来抽象资源</p> <p>通往 REST 的第一步是引入资源的概念，在 API 中基本的体现是围绕着资源而不是过程来设计服务，说的直白一点，可以理解为服务的 Endpoint 应该是一个名词而不是动词。此外，每次请求中都应包含资源的 ID，所有操作均通过资源 ID 来进行（主键 ID）</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /doctors/mjones HTTP/<span class="token number">1.1</span>
<span class="token punctuation">{</span>date<span class="token operator">:</span> <span class="token string">&quot;2020-03-04&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后服务器传回一组包含了 ID 信息的档期清单，注意，ID 是资源的唯一编号，有 ID 即代表“医生的档期”被视为一种资源：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
<span class="token punctuation">[</span>
	<span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span> start<span class="token operator">:</span><span class="token string">&quot;14:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;14:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">5678</span><span class="token punctuation">,</span> start<span class="token operator">:</span><span class="token string">&quot;16:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;16:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我还是觉得 14:00 的时间比较合适，于是又进行预约确认，并提交了我的基本信息：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /schedules/<span class="token number">1234</span> HTTP/<span class="token number">1.1</span>
<span class="token punctuation">{</span>name<span class="token operator">:</span> icyfenix<span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> ……<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="http-verbs-引入统一接口"><a href="#http-verbs-引入统一接口" class="header-anchor">#</a> HTTP Verbs：引入统一接口</h4> <p>第 1 级遗留三个问题都可以靠引入统一接口来解决。HTTP 协议的七个标准方法是经过精心设计的，只要架构师的抽象能力够用，它们几乎能涵盖资源可能遇到的所有操作场景。REST 的做法是把不同业务需求抽象为对资源的增加、修改、删除等操作来解决第一个问题；使用 HTTP 协议的 Status Code，可以涵盖大多数资源操作可能出现的异常，而且 Status Code 也是可以自定义扩展，以此解决第二个问题；依靠 HTTP Header 中携带的额外认证、授权信息来解决第三个问题，这个在实战中并没有体现，请参考安全架构中的“ 凭证 ”相关内容</p> <p>按这个思路，获取医生档期，应采用具有查询语义的 GET 操作进行：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /doctors/mjones/schedule?date=<span class="token number">2020</span><span class="token number">-03</span><span class="token number">-04</span>&amp;status=open HTTP/<span class="token number">1.1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后服务器会传回一个包含了所需信息的回应：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
<span class="token punctuation">[</span>
	<span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span> start<span class="token operator">:</span><span class="token string">&quot;14:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;14:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">5678</span><span class="token punctuation">,</span> start<span class="token operator">:</span><span class="token string">&quot;16:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;16:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我仍然觉得 14:00 的时间比较合适，于是又进行预约确认，并提交了我的基本信息，用以创建预约，这是符合 POST 的语义的：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>POST /schedules/<span class="token number">1234</span> HTTP/<span class="token number">1.1</span>
<span class="token punctuation">{</span>name<span class="token operator">:</span> icyfenix<span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> ……<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果预约成功，那我能够收到一个预约成功的响应：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">201</span> Created
Successful confirmation of appointment
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果发生了问题，譬如有人在我前面抢先预约了，那么我会在响应中收到某种错误信息：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">409</span> Conflict
doctor not available
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="hypermedia-controls-超媒体控制-超文本驱动"><a href="#hypermedia-controls-超媒体控制-超文本驱动" class="header-anchor">#</a> Hypermedia Controls：超媒体控制（超文本驱动）</h4> <p>第 2 级是目前绝大多数系统所到达的 REST 级别（这是有原因的）。但仍不是完美的，至少还存在一个问题：你是如何知道预约 mjones 医生的档期是需要访问/schedules/1234这个服务 Endpoint 的？也许你甚至第一时间无法理解为何我会有这样的疑问，这当然是程序代码写的呀！但 REST 并不认同这种已烙在程序员脑海中许久的想法。RMM 中的 Hypermedia Controls、Fielding 论文中的 HATEOAS 和现在提的比较多的“超文本驱动”，所希望的是除了第一个请求是有你在浏览器地址栏输入所驱动之外，其他的请求都应该能够自己描述清楚后续可能发生的状态转移，由超文本自身来驱动。所以，当你输入了查询的指令之后：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /doctors/mjones/schedule?date=<span class="token number">2020</span><span class="token number">-03</span><span class="token number">-04</span>&amp;status=open HTTP/<span class="token number">1.1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>服务器传回的响应信息应该包括诸如如何预约档期、如何了解医生信息等可能的后续操作：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
<span class="token punctuation">{</span>
	schedules：<span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			id<span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span> start<span class="token operator">:</span><span class="token string">&quot;14:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;14:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">,</span>
			links<span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token punctuation">{</span>rel<span class="token operator">:</span> <span class="token string">&quot;comfirm schedule&quot;</span><span class="token punctuation">,</span> href<span class="token operator">:</span> <span class="token string">&quot;/schedules/1234&quot;</span><span class="token punctuation">}</span>
			<span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>
			id<span class="token operator">:</span> <span class="token number">5678</span><span class="token punctuation">,</span> start<span class="token operator">:</span><span class="token string">&quot;16:00&quot;</span><span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token string">&quot;16:50&quot;</span><span class="token punctuation">,</span> doctor<span class="token operator">:</span> <span class="token string">&quot;mjones&quot;</span><span class="token punctuation">,</span>
			links<span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token punctuation">{</span>rel<span class="token operator">:</span> <span class="token string">&quot;comfirm schedule&quot;</span><span class="token punctuation">,</span> href<span class="token operator">:</span> <span class="token string">&quot;/schedules/5678&quot;</span><span class="token punctuation">}</span>
			<span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	links<span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>rel<span class="token operator">:</span> <span class="token string">&quot;doctor info&quot;</span><span class="token punctuation">,</span> href<span class="token operator">:</span> <span class="token string">&quot;/doctors/mjones/info&quot;</span><span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>如果做到了第 3 级 REST，那服务端的 API 和客户端也是完全解耦的，你要调整服务数量，或者同一个服务做 API 升级将会变得非常简单。但是缺点是将原先在客户端就可以使用的行为放到了服务端，并且用大量的数据来处理状态转移这件事就很有争议</p> <h2 id="rpc-框架的超时实现原理"><a href="#rpc-框架的超时实现原理" class="header-anchor">#</a> RPC 框架的超时实现原理</h2> <p>consumer 调用 provider，如果不设置超时时间，则 consumer 的响应时间肯定会大于 provider 的响应时间。当 provider 性能变差时，consumer 的性能也会受到影响，因为它必须无限期地等待 provider 的返回。因此服务间调用会有一些降级、熔断、重试、超时机制存在，这些机制保证了分布式系统的健壮性，现在很多大厂都有一个统一的平台来管理系统间调用的配置，那在底层他们是任何实现超时配置的呢？我们以 dubbo 底层实现机制做讲解</p> <p>dubbo 的每个调用端设置的超时时间都不一样，每个被调用端也可以设置超时时间，dubbo 会以下面的优先级来设置时长：消费端方法级 &gt; 服务端方法级 &gt; 消费端接口级 &gt; 服务端接口级 &gt; 消费端全局 &gt; 服务端全局。<strong>当调用端发起请求时，它会将超时时间作为请求的一部分传递给被调用端</strong>。被调用端在处理请求时会根据这个超时时间来进行超时判断</p> <p>接口级配置：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.example.DemoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>方法级配置：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.example.DemoService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>specificMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">dubbo:</span>reference</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>dubbo 的超时时间判断实现逻辑在被调用端，调用端代码只是打了一个 warn 日志</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RpcException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行真正的逻辑调用，并统计耗时</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Result</span> result <span class="token operator">=</span> invoker<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>invocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> elapsed <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>

        <span class="token comment">// 判断是否超时</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>invoker<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> elapsed <span class="token operator">&gt;</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 打印warn日志</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;invoke time out...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>被调用端的代码如下，注意到下面有个重试次数的判断，之前我以为重试是调用端行为，现在看是将重试次数作为参数一起穿给被调用端了：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FailoverClusterInvoker</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">doInvoke</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">// 循环调用设定的重试次数</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> retryTimes<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Result</span> result <span class="token operator">=</span> invoker<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>invocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RpcException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 如果是业务异常，终止重试</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">isBiz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                le <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                le <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RpcException</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RpcException</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>被调用端的超时判断如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        timeout <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 循环判断</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 放弃锁，进入等待状态</span>
                done<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 判断是否已经返回结果或者已经超时</span>
                <span class="token keyword">long</span> elapsed <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> elapsed <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> var8<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>var8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果未返回结果，则抛出超时异常</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">returnFromResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>这里新起了一个线程来占用 CPU 资源，来判断请求是否超时，还加了一把锁，可能是为了防止多个重复请求。这里可以使用类似延迟消息的思路，起个时间轮管理每个接口的超时时间</p> <h2 id="rpc-框架的熔断实现原理"><a href="#rpc-框架的熔断实现原理" class="header-anchor">#</a> RPC 框架的熔断实现原理</h2> <p>也来简单聊一下熔断机制的实现吧：</p> <p>1，关闭状态（Closed）：正常情况下，服务处于关闭状态，允许请求通过
2，打开状态（Open）：当服务出现故障（如连续多次调用失败）时，切换到打开状态，直接返回错误结果，不向后端服务发送请求
3，半开状态（Half-Open）：经过一段时间后，从打开状态切换到半开状态，允许少量请求通过，以检测服务是否恢复。如果请求成功，则切换回关闭状态；否则，重新切换到打开状态</p> <p>如果是集群部署的话，注册中心会维护一个计数器和阈值：设定一个时间窗口，记录这个时间窗口内的请求次数和失败次数。设定一个阈值，当失败次数超过阈值时，触发熔断</p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/yf_blog/tags/?tag=%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8" title="标签">#远程服务调用</a></div> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">1/17/2026, 2:51:21 AM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/yf_blog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/yf_blog/pages/2be181/"><div>
            关于分布式系统 RPC 中高可用功能的实现
            <!----></div></a> <span class="date">01-07</span></dt></dl><dl><dd>02</dd> <dt><a href="/yf_blog/pages/4d2daf/"><div>
            VuePress 博客搭建指南
            <!----></div></a> <span class="date">01-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/yf_blog/pages/89a3cf/"><div>
            Vercel 部署教程
            <!----></div></a> <span class="date">01-02</span></dt></dl> <dl><dd></dd> <dt><a href="/yf_blog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/yf_blog/assets/js/app.f151afcb.js" defer></script><script src="/yf_blog/assets/js/3.86e8edc4.js" defer></script><script src="/yf_blog/assets/js/2.e5572c9a.js" defer></script><script src="/yf_blog/assets/js/124.0fbcc996.js" defer></script>
  </body>
</html>
