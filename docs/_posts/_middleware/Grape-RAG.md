---
title: Grape-RAG
date: 2025-01-11
categories:
  - 中间件
tags:
  - RAG
---
# 传统 RAG 的局限性
经典的 RAG 架构以向量数据库（VectorDB）为核心来检索语义相似性上下文，让大语言模型（LLM）不需要重新训练就能够获取最新的知识，其工作流如下图所示：
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/ceea3f63f01d4d02a9da5a27dd3d4f23.png)

这一架构目前广泛应用于各类 AI 业务场景中，例如问答机器人、智能客服、私域知识库检索等等。虽然 RAG 通过知识增强一定程度上缓解了 LLM 幻觉问题，但是依然面临准确度不高的问题，它受限于信息检索流程固有的限制（比如信息检索相关性、搜索算法效率、Embedding模型）以及大量对 LLM 能力依赖，使得在生成结果的过程中有了更多的不确定性

下图来自 RAG 领域一篇著名的论文：[Seven Failure Points When Engineering a Retrieval Augmented Generation System](https://arxiv.org/abs/2401.05856)，它总结了在使用 RAG 架构时经常会遇到的一些问题（红框部分，原作者称之为7个失败点）
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/655cc35bfeb046eda9d0a8fb53aced7f.png)
这些问题总结起来就是**向量无法真实的模拟现实世界，RAG 受到了处理字符串而不是事物的限制**

但是上面的问题目前在工程上都有一些优化方法来提升回答准确度，但是有没有统一的方法去一次性处理这些问题呢

因此除了基于语义匹配文本块之外，业内也探索新的数据检索形式，比如在语义之上关注数据之间的关联性

这种关联性区别于关系模型中的逻辑性强依赖，而是带有一定的**语义关联**。比如人和手机是两个独立的实体，在向量数据库中的相似性一定非常差，但是结合实际生活场景，人和手机的关系是非常密切的，假如我搜索一个人的信息，我大可能性也关心他的周边，例如用什么型号的手机、喜欢拍照还是玩游戏等等

基于这样的关系模型，从知识库检索出来的上下文在某些场景中可能更有效，例如公司里面喜欢使用手机拍照的人有哪些
# 图的优点
苹果的向量表示是一个数字数组，是统计学的产物。向量的神奇之处在于它们能够以编码形式捕捉对应文本的本质。然而，在 RAG 的语境中，向量只有在你需要比较一组词语与另一组词语的相似性时才有用

进行这种比较的过程非常简单，只需运行相似性计算（即向量数学）并获得匹配结果。但如果你想理解向量内部的内容，了解它周围的环境，或者理解这些内容在更大背景中的意义，向量作为一种表示方式就显得不足

相比之下，知识图谱是一种声明性的表示方式，或者用 AI 的术语来说，是符号化的表示方式（结构化数据）。这样，人类和机器都可以理解和推理知识图谱。这是一个重大突破，我们会在后面进一步讨论。此外，你还可以查询、可视化、注释、修正和扩展知识图谱。知识图谱代表了你的世界模型，即你所研究领域的那部分世界，图会通过节点（实体）、边（关系）、属性（实体 / 关系的特征）直接描述现实中的关联结构。例如社交网络中，用户是节点，关注是边，边可携带关注时间等属性

此外，图还可以使用图遍历算法（如深度优先搜索 DFS、广度优先搜索 BFS）快速完成多层关联查询
# 用知识图谱来呈现数据关系
为了有效地描述知识库中的抽象数据关系，引入了知识图谱的概念，它不再使用二维表格来组织数据，而是用图结构来描述关系，这里面的关系没有固定的范式约束，类似下面这种人物关系图：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/2f447e1f598143c4b750119c30197c84.png)上图中有最重要的三个元素：对象（人物）、属性（身份）、关系，对于存储这样的数据有专门的数据库产品来支持，即图数据库（GraphDB）

图数据库是属于 NoSQL 的一种，它有着较为灵活的 schema 定义，可以简单高效表达真实世界中任意的关联关系。图数据库中的主要概念有：

- 实体（Entity），也称之为顶点或节点，图结构中的对象
- 边（Edge），连接两个实体的一条路径，即实体之间的关系
- 属性（Property），用来具体描述实体或边的特征

当然知识图片除了将这些关系存储起来，还有其他的能力比如实体识别、关系抽取、图构建等功能

图节点的删除比文本向量库中删除要难多了，因此 graphRAG 适合读多写少的场景
# GraphRAG
如果借用 VectorRAG 的思想，通过图数据库来实现检索增强的话就演变出了 GraphRAG 架构，整体流程和 VectorRAG 并无差异，只是新知识的存储和检索都用知识图谱来实现，解决 VectorRAG 对抽象关系理解较弱的问题

整体流程和文本 RAG 一致，只不过搜索内容从文本变成了图。VectorRAG 擅长处理具有一定事实性的问题，对复杂关系理解较弱，而 GraphRAG 刚好弥补了这一点，如果把这两者进行结合，理论上能得到更优的结果

当然，图 RAG 也有自身的缺点，比如：

1，新增或者删除知识项的代价很大：文本知识库中，数据删了就是删了，但是在 GraphRAG 中，除去删掉这个知识项的实体，我们还需要删除这个知识项和其他知识项的所有关系，对于其他的知识项来说，这个知识项不复存在了
2，对于 LLM 来说，使用图 RAG 的 token 代价会比较高