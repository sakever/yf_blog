(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{443:function(s,a,t){"use strict";t.r(a);var n=t(15),r=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"mysql-大表优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-大表优化"}},[s._v("#")]),s._v(" Mysql 大表优化")]),s._v(" "),a("p",[s._v("如果存储的数据过多，查询效率会大大降低，如何去解决这个问题？")]),s._v(" "),a("p",[s._v("1，限定数据的范围：禁止不带任何限制数据范围条件的查询语句，这样就不用查询整个数据库")]),s._v(" "),a("p",[s._v("2，范式优化（垂直拆表）：优化为 BC 范式，删除重复数据，或者单纯的拆字段")]),s._v(" "),a("p",[s._v("3，水平拆表：保持数据表结构不变，通过某种策略将存储的数据分片。这样每一片数据分散到不同的表或者库中")]),s._v(" "),a("p",[s._v("4，读写分离：主读副写，配置一下来实现 mysql 的主从复制")]),s._v(" "),a("p",[s._v("今天介绍的重点就是垂直拆表（拆字段）和水平拆表（拆数据）")]),s._v(" "),a("h2",{attrs:{id:"分表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分表"}},[s._v("#")]),s._v(" 分表")]),s._v(" "),a("p",[s._v("垂直分表：表中的字段较多，一般将不常用的、数据较大、长度较长的拆分到扩展表。一般情况加表的字段可能有几百列，此时是按照字段进行数竖直切。注意垂直分是列多的情况")]),s._v(" "),a("p",[s._v("垂直分表的拆分原则是将热点数据（可能会冗余经常一起查询的数据）放在一起作为主表，非热点数据放在一起作为扩展表。这样更多的热点数据就能被缓存下来，进而减少了随机读 IO。拆了之后，要想获得全部数据就需要关联两个表来取数据。但记住，千万别用 join，因为 join 不仅会增加 CPU 负担并且会讲两个表耦合在一起")]),s._v(" "),a("p",[s._v("水平分表：单表的数据量太大。按照某种规则（RANGE、HASH 取模等），切分到多张表里面去。 但是这些表还是在同一个库中，所以库级别的数据库操作还是有 IO 瓶颈。这种情况是不建议使用的，因为数据量是逐渐增加的，当数据量增加到一定的程度还需要再进行切分。比较麻烦")]),s._v(" "),a("p",[s._v("同时注意，分库分表不要自己手写代码，这样容易和业务代码耦合，维护起来很困难。我在线上就见过以 product_id 的某位分成10个表的业务代码，我们可以借助一些框架处理这个问题，比如 MyCAT、Cobar 之类的")]),s._v(" "),a("h3",{attrs:{id:"mycat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mycat"}},[s._v("#")]),s._v(" MyCat")]),s._v(" "),a("p",[s._v("Mycat 是数据库中间件，所谓中间件数据库中间件是连接 Java 应用程序和数据库中间的软件")]),s._v(" "),a("ul",[a("li",[s._v("一个彻底开源的，面向企业应用开发的大数据库集群")]),s._v(" "),a("li",[s._v("支持事务、ACID、可以替代 MySQL 的加强版数据库")]),s._v(" "),a("li",[s._v("一个可以视为 MySQL 集群的企业级数据库，用来替代昂贵的 Oracle 集群")]),s._v(" "),a("li",[s._v("一个融合内存缓存技术、NoSQL 技术、HDFS 大数据的新型 SQL Server")]),s._v(" "),a("li",[s._v("结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品\n一个新颖的数据库中间件产品")])]),s._v(" "),a("p",[s._v("Mycat 作用为：能满足数据库数据大量存储；提高了查询性能\n"),a("img",{attrs:{src:"https://i-blog.csdnimg.cn/direct/60342f9fe033412cb6422ff45aa044c0.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"sharing-sphere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sharing-sphere"}},[s._v("#")]),s._v(" sharing-sphere")]),s._v(" "),a("p",[s._v("Apache ShardingSphere 是一款分布式的数据库生态系统， 可以将任意数据库转换为分布式数据库，并通过数据分片、弹性伸缩、加密等能力对原有数据库进行增强")]),s._v(" "),a("p",[s._v("sharing-sphere 可以用来实现进行多库分表，只需要一些简单的配置即可")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.shardingsphere"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sharding-jdbc-spring-boot-starter"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("4.1.1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("mysql-connector-java"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.baomidou"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("mybatis-plus-boot-starter"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("相关配置：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("spring"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  shardingsphere"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      sql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        ## 打印sql\n        show"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    datasource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用两个库 ds0 和 ds1")]),s._v("\n      names"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ds0\n      ds0"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        jdbc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" jdbc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("your_database"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("useUnicode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("characterEncoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("useSSL"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("serverTimezone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Asia")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Shanghai")]),s._v("\n        username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" root\n        password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n        type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("zaxxer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hikari"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("HikariDataSource")]),s._v("\n        driver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Driver")]),s._v("\n      ds1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    sharding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      ## 数据分片规则配置\n      tables"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        ## 逻辑表名称\n        document_trans"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          ## 由数据源名 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 表名组成（参考 "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Inline")]),s._v(" 语法规则）\n          ## actual"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ds0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("document_trans_"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" （"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("代表任意个表），如果是 ds0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("document_trans_$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 就表示"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("到"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("个表\n          actual"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ds0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("document_trans_"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n          ## 分表策略\n          table"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("strategy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            ## 用于单分片键的标准分片场景\n            standard"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n              ## 自定义分片算法实现类\n              precise"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("algorithm"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("algorithm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("MyTableStandardPreciseAlgorithm")]),s._v("\n              ## 除了分片算法实现类，我们还可以使用 sharding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("algorithm"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name 来指定一些比较简单的分片算法\n              sharding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("algorithm"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" my"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("table"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("algorithm\n              ## 分片列名称\n              sharding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("column"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" enterprise_id\n\n          ## 分片算法配置\n          sharding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("algorithms"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            ## 上面定义的分表算法\n            my"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("table"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("algorithm"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n              ## 该分表算法的类型\n              type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INLINE")]),s._v("\n              props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n              \t## 具体的分表算法，我们采用 enterprise_id 除以"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("的余数来算\n                algorithm"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("expression"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" document_trans_$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("enterprise_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])]),a("p",[s._v("配置完毕后自动进行分表，但是有一个缺点，就是后续查数据可能比较麻烦了")]),s._v(" "),a("p",[s._v("官网："),a("a",{attrs:{href:"https://shardingsphere.apache.org/document/current/cn/overview/",target:"_blank",rel:"noopener noreferrer"}},[s._v("sharing-sphere"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("shardingsphere 高版本（5.1.x以上）导入的时候可能会遇到一个问题")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.apache.shardingsphere.infra.config.mode.ModeConfiguration' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ModeConfiguration 找不到，这时候需要在 application.yml 中配置，或者在代码中创建 ModeConfiguration，推荐用以下配置")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("  shardingsphere"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      sql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("show"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Standalone")]),s._v("\n      repository"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),s._v("\n        props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" classpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shardingsphere\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"分库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分库"}},[s._v("#")]),s._v(" 分库")]),s._v(" "),a("p",[s._v("业务分库：一个数据库的表太多。此时就会按照一定业务逻辑进行垂直切分，比如用户相关的表放在一个数据库里，订单相关的表放在一个数据库里。注意此时不同的数据库应该存放在不同的服务器上，此时磁盘空间、内存、TPS 等等都会得到解决。这个一般在业务线上都有涉及")]),s._v(" "),a("p",[s._v("使用业务分库基本上就可以服务化了。例如，随着业务的发展一些公用的配置表、字典表等越来越多，这时可以将这些表拆到单独的库中，甚至可以服务化")]),s._v(" "),a("p",[s._v("数据分库：水平分库理论上切分起来是比较麻烦的，它是指将单张表的数据根据某种依据（hash、range 等）切分到多个服务器上去，每个服务器具有相应的库与表，只是表中数据集合不同。 水平分库分表能够有效的缓解单机和单库的性能瓶颈和压力，突破 IO、连接数、硬件资源等的瓶颈")]),s._v(" "),a("h2",{attrs:{id:"分库分表问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分库分表问题"}},[s._v("#")]),s._v(" 分库分表问题")]),s._v(" "),a("h3",{attrs:{id:"非-partition-key-的查询问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非-partition-key-的查询问题"}},[s._v("#")]),s._v(" 非 partition key 的查询问题")]),s._v(" "),a("p",[s._v("partition key 表示数据分库的依据，比如我们按照主键的奇偶性，去将数据分到两个库中。此时主键就是 partition key。如果用户使用了其他字段做查询，就比较麻烦了")]),s._v(" "),a("p",[s._v("此时我们可以先将这其他字段转换为主键，然后再查询，如果希望每次查询时不这么麻烦，可以将数据整合放入中间件中，比如将数据放进 es 中，从 es 中查出主键，然后去数据库中查询完整的数据")]),s._v(" "),a("h3",{attrs:{id:"扩容问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容问题"}},[s._v("#")]),s._v(" 扩容问题")]),s._v(" "),a("p",[s._v("数据太多了，我们先再增加几个库存放这张表的数据。此时我们可以借鉴 java 中 hashmap 扩容的做法。扩容是成倍的，就像下图一样")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i-blog.csdnimg.cn/blog_migrate/4bfc72481a63ac3e6226ebcc99bfb003.png",alt:"在这里插入图片描述"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);